{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="{{ profile.bio|truncatewords:20|default:'Calvin Kiiza Bamwesigye - Business Intelligence Analyst, ML Engineer & Data Scientist.' }}">
    <meta name="keywords"
        content="Data Science, Machine Learning, AI, Business Intelligence, Python, SQL, Deep Learning">
    <meta name="author" content="{{ profile.name|default:'Calvin Kiiza Bamwesigye' }}">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{ profile.name }} - Portfolio">
    <meta property="og:description" content="{{ profile.title }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://173.208.162.233/">
    <meta property="og:image" content="{% static 'images/portfolio-preview.png' %}">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="173.208.162.233">
    <meta property="twitter:url" content="http://173.208.162.233/">
    <meta name="twitter:title" content="{{ profile.name|default:'Calvin Kiiza Bamwesigye' }} - Portfolio">
    <meta name="twitter:description"
        content="{{ profile.title|default:'Business Intelligence Analyst & ML Engineer' }}">
    <meta name="twitter:image" content="{% static 'images/portfolio-preview.png' %}">

    <title>{{ profile.name|default:'Calvin Kiiza Bamwesigye' }}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'></text></svg>">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <style>
        /* INLINE COMPELLED STYLES FOR PUBLICATIONS & AWARDS */
        .publications-grid,
        .awards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .publication-card,
        .award-card {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 2rem;
            position: relative;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .publication-card:hover,
        .award-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-accent-primary);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }

        .pub-icon,
        .award-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .award-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            /* Removed gradient as it messes up emojis */
        }

        .pub-title,
        .award-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--color-text-primary);
            line-height: 1.4;
        }

        .pub-title {
            color: var(--color-accent-primary);
        }

        .pub-meta,
        .award-org {
            font-size: 0.875rem;
            color: var(--color-text-muted);
            margin-bottom: 1rem;
        }

        .award-date {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(99, 102, 241, 0.1);
            color: var(--color-accent-primary);
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: auto;
            align-self: flex-start;
        }

        .pub-authors {
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            line-height: 1.6;
            margin-bottom: 1.5rem;
            flex-grow: 1;
        }

        .pub-actions {
            margin-top: auto;
        }
    </style>
</head>

<body>
    <canvas id="bg-canvas"></canvas>

    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="container nav-container">
            <a href="#home" class="nav-logo">Calvin BK </a>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">
                    <span class="theme-icon-light">‚òÄÔ∏è</span>
                    <span class="theme-icon-dark" style="display: none;">üåô</span>
                </button>
                <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="#home" class="nav-link active">Home</a></li>
                <li><a href="#about" class="nav-link">About & Education</a></li>
                <li><a href="#awards" class="nav-link">Awards</a></li>
                <li><a href="#experience" class="nav-link">Experience</a></li>
                <li><a href="#projects" class="nav-link">Projects</a></li>
                <li><a href="#skills" class="nav-link">Skills</a></li>
                <li><a href="#contact" class="nav-link">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero section" id="home">
        <div class="container">
            {% if profile %}
            <div class="hero-content">
                <p class="hero-greeting">üëã Hello, I'm</p>
                <h1 class="hero-title">
                    {{ profile.name }}
                </h1>
                <p class="hero-subtitle">
                    {{ profile.bio }}
                </p>
                <div class="hero-cta">
                    <a href="#projects" class="btn btn-primary">
                        <span>View My Work</span>
                        <span>‚Üí</span>
                    </a>
                    <a href="#contact" class="btn btn-secondary">
                        <span>Get In Touch</span>
                    </a>
                </div>
            </div>
            {% else %}
            <!-- Fallback content if no profile exists -->
            <div class="hero-content">
                <p class="hero-greeting">üëã Hello, I'm</p>
                <h1 class="hero-title">
                    Calvin Kiiza <span class="gradient-text">Bamwesigye</span>
                </h1>
                <p class="hero-subtitle">
                    Business Intelligence Analyst & ML Engineer passionate about transforming data into actionable
                    insights and building AI-powered solutions
                </p>
                <div class="hero-cta">
                    <a href="#projects" class="btn btn-primary">
                        <span>View My Work</span>
                        <span>‚Üí</span>
                    </a>
                    <a href="#contact" class="btn btn-secondary">
                        <span>Get In Touch</span>
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- About Section -->
    <section class="section" id="about">
        <div class="container">
            <div class="section-title">
                <h2>About Me & Education</h2>
            </div>

            <!-- Education -->
            <div class="card fade-in-up stagger-1" style="max-width: 900px; margin: 0 auto;">
                <h3>üéì Education</h3>
                <div class="timeline">
                    {% for edu in education %}
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">{{ edu.start_date }} ‚Äì {{ edu.end_date }}</div>
                            <h4 class="timeline-title">{{ edu.degree }}</h4>
                            <p class="timeline-subtitle">{{ edu.institution }}</p>
                            {% if edu.description %}
                            <p class="timeline-text">{{ edu.description }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <p>No education details added yet.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <!-- Awards Section -->
    <section class="section" id="awards">
        <div class="container">
            <div class="section-title">
                <h2>Awards & Recognition</h2>
            </div>

            <div class="awards-grid">
                {% for award in awards %}
                <div class="award-card reveal stagger-1">
                    <div class="award-icon">{{ award.icon }}</div>
                    <div class="award-content">
                        <h3 class="award-title">{{ award.title }}</h3>
                        <span class="award-org">{% if award.organization %}{{ award.organization }}{% endif %}</span>
                    </div>
                    {% if award.date %}
                    <span class="award-date">{{ award.date }}</span>
                    {% endif %}
                </div>
                {% empty %}
                <p>No awards added yet.</p>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Experience Section -->
    <section class="section" id="experience">
        <div class="container">
            <div class="section-title">
                <h2>Work Experience</h2>
            </div>
            <div class="timeline">
                {% for job in experience %}
                <div class="timeline-item reveal modal-trigger" data-title="{{ job.position }} @ {{ job.company }}"
                    data-description="{{ job.description|safe }}" data-icon="üíº">
                    <div class="timeline-content">
                        <div class="timeline-date">{{ job.start_date }} ‚Äì {{ job.end_date }}</div>
                        <h3 class="timeline-title">{{ job.position }}</h3>
                        <p class="timeline-subtitle">{{ job.company }}</p>
                        <div style="color: var(--color-text-secondary); margin-top: 1rem;">
                            {{ job.description|safe|truncatewords_html:15 }}
                        </div>
                        <button class="btn-text" style="margin-top: 1rem; font-size: 0.9rem;">Read more</button>
                    </div>
                </div>
                {% empty %}
                <p class="text-center">No work experience added yet.</p>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Projects Section -->
    <section class="section" id="projects">
        <div class="container">
            <div class="section-title">
                <h2>Featured Projects</h2>
            </div>
            <div class="grid grid-2">
                {% for project in projects %}
                <div class="project-card reveal modal-trigger" data-title="{{ project.title }}"
                    data-description="{{ project.description }}" data-icon="{{ project.image_icon }}"
                    data-image="{% if project.image %}{{ project.image.url }}{% endif %}"
                    data-tech="{{ project.technologies }}" data-link="{{ project.link }}"
                    data-link-text="{{ project.link_text }}">
                    {% if project.image %}
                    <div class="project-image"
                        style="background-image: url('{{ project.image.url }}'); background-size: cover; background-position: center;">
                    </div>
                    {% else %}
                    <div class="project-image">{{ project.image_icon }}</div>
                    {% endif %}
                    <div class="project-content">
                        <h3 class="project-title">{{ project.title }}</h3>
                        <p class="project-description">
                            {{ project.description|truncatewords:20 }}
                        </p>
                        <div class="project-tech">
                            {% for tech in project.get_tech_list|slice:":3" %}
                            <span class="badge">{{ tech }}</span>
                            {% endfor %}
                            {% if project.get_tech_list|length > 3 %}
                            <span class="badge">+{{ project.get_tech_list|length|add:"-3" }}</span>
                            {% endif %}
                        </div>
                        <button class="btn-text">View Details ‚Üí</button>
                    </div>
                </div>
                {% empty %}
                <p class="text-center">No projects added yet.</p>
                {% endfor %}
            </div>

            <!-- Publications -->
            {% if publications %}
            <div class="section-title" style="margin-top: 4rem;">
                <h2>Publications</h2>
            </div>
            <div class="publications-grid">
                {% for pub in publications %}
                <div class="publication-card reveal stagger-1">
                    <div class="pub-icon">üìÑ</div>
                    <h3 class="pub-title">{{ pub.title }}</h3>
                    <div class="pub-meta">
                        <span>üìÖ {{ pub.date }}</span>
                        <span>‚Ä¢</span>
                        <span>{{ pub.journal }}</span>
                    </div>
                    <p class="pub-authors">
                        <strong>Authors:</strong> {{ pub.authors|truncatechars:100 }}
                    </p>
                    <div class="pub-actions">
                        {% if pub.paper %}
                        <a href="{{ pub.paper.url }}" target="_blank" class="btn btn-sm btn-primary">
                            View Paper üìÑ
                        </a>
                        {% elif pub.link %}
                        <a href="{{ pub.link }}" target="_blank" class="btn-text">
                            Read Online ‚Üí
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Skills Section -->
    <section class="section" id="skills">
        <div class="container">
            <div class="section-title">
                <h2>Skills & Technologies</h2>
            </div>
            <div class="skills-grid-new">
                <div class="skill-category-card reveal stagger-1">
                    <div class="category-header">
                        <span class="category-icon">üíª</span>
                        <h3>Technologies</h3>
                    </div>
                    <div class="skill-badges">
                        {% for skill in tech_skills %}
                        <div class="skill-badge-item">
                            <span class="skill-dot"></span>
                            <span class="skill-name">{{ skill.name }}</span>
                        </div>
                        {% empty %}
                        <p class="text-muted">No technology skills added.</p>
                        {% endfor %}
                    </div>
                </div>

                <div class="skill-category-card reveal stagger-2">
                    <div class="category-header">
                        <span class="category-icon">üåç</span>
                        <h3>Languages</h3>
                    </div>
                    <div class="skill-badges">
                        {% for skill in lang_skills %}
                        <div class="skill-badge-item">
                            <span class="skill-dot"></span>
                            <span class="skill-name">{{ skill.name }}</span>
                        </div>
                        {% empty %}
                        <p class="text-muted">No language skills added.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="section" id="contact">
        <div class="container">
            <div class="section-title">
                <h2>Get In Touch</h2>
                <p style="color: var(--color-text-secondary); max-width: 600px; margin: 1rem auto 0;">
                    I'm always open to discussing new opportunities, collaborations, or just connecting with fellow tech
                    enthusiasts!
                </p>
            </div>
            <!-- Success Message -->
            {% if messages %}
            <div class="container" style="margin-bottom: 2rem;">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="contact-split-grid">
                <!-- Contact Info Column -->
                <div class="contact-info-column reveal stagger-1">
                    <div class="contact-info-card">
                        <div class="info-icon">üìß</div>
                        <div class="info-content">
                            <span class="info-label">Email Me</span>
                            <a href="mailto:{% if profile %}{{ profile.email }}{% else %}bamwesigyecalvinkiiza@gmail.com{% endif %}"
                                class="info-value">
                                {% if profile %}{{ profile.email }}{% else %}bamwesigyecalvinkiiza@gmail.com{% endif %}
                            </a>
                        </div>
                    </div>

                    <div class="contact-info-card">
                        <div class="info-icon">üì±</div>
                        <div class="info-content">
                            <span class="info-label">Call Me</span>
                            <a href="tel:{% if profile %}{{ profile.phone }}{% else %}+256762496588{% endif %}"
                                class="info-value">
                                {% if profile %}{{ profile.phone }}{% else %}+256 762 496 588{% endif %}
                            </a>
                        </div>
                    </div>

                    <div class="contact-info-card">
                        <div class="info-icon">üåê</div>
                        <div class="info-content">
                            <span class="info-label">Location</span>
                            <a href="https://www.google.com/maps/search/?api=1&query={% if profile %}{{ profile.address|urlencode }}{% else %}Uganda{% endif %}"
                                target="_blank" class="info-value">
                                {% if profile %}{{ profile.address }}{% else %}Uganda{% endif %}
                            </a>
                        </div>
                    </div>

                    <div class="social-connect" style="margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem;">Connect with me</h4>
                        <div class="social-icons-row">
                            {% if profile.linkedin_link %}
                            <a href="{{ profile.linkedin_link }}" target="_blank" class="social-link" title="LinkedIn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z">
                                    </path>
                                    <rect x="2" y="9" width="4" height="12"></rect>
                                    <circle cx="4" cy="4" r="2"></circle>
                                </svg>
                            </a>
                            {% endif %}
                            {% if profile.github_link %}
                            <a href="{{ profile.github_link }}" target="_blank" class="social-link" title="GitHub">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path
                                        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
                                    </path>
                                </svg>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Contact Form Column -->
                <div class="contact-form-column reveal stagger-2">
                    <form method="POST" class="premium-form">
                        {% csrf_token %}
                        <div class="form-row">
                            <div class="form-group">
                                {{ form.name }}
                            </div>
                            <div class="form-group">
                                {{ form.email }}
                            </div>
                        </div>
                        <div class="form-group">
                            {{ form.subject }}
                        </div>
                        <div class="form-group">
                            {{ form.message }}
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <span>Send Message</span>
                            <span>üöÄ</span>
                        </button>
                    </form>
                </div>
            </div>

            <div class="social-links">
                {% if profile.linkedin_link %}
                <a href="{{ profile.linkedin_link }}" target="_blank" class="social-link" aria-label="LinkedIn">
                    <span>üíº</span>
                </a>
                {% endif %}
                {% if profile.github_link %}
                <a href="{{ profile.github_link }}" target="_blank" class="social-link" aria-label="GitHub">
                    <span>üíª</span>
                </a>
                {% endif %}
                {% if not profile %}
                <a href="#" class="social-link" aria-label="LinkedIn"><span>üíº</span></a>
                <a href="#" class="social-link" aria-label="GitHub"><span>üíª</span></a>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; {% now "Y" %} {{ profile.name|default:'Calvin Kiiza Bamwesigye' }}. All rights reserved.</p>
                <p style="margin-top: 0.5rem; font-size: 0.85rem;">Built with passion for innovation and excellence</p>
            </div>
        </div>
    </footer>

    <!-- Modal Structure -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <div id="modalIcon" class="modal-icon"></div>
                <h2 id="modalTitle"></h2>
            </div>
            <div class="modal-body">
                <p id="modalDescription"></p>
                <div id="modalTech" class="modal-tech-stack"></div>
                <div id="modalLinks" class="project-links"></div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{% static 'js/script.js' %}"></script>
</body>

</html>